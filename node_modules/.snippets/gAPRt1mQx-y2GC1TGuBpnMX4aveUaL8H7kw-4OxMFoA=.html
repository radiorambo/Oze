<div class="copy-code-block code-block"><span class="filename">src/routes/login/+page.server.js</span><pre class="language-diff" style="background-color: var(--shiki-color-background)"><code><span class="inserted">import { fail, redirect } from &#39;@sveltejs/kit&#39;;
</span>
/** @type {import(&#39;./$types&#39;).Actions} */
export const actions = {
<span class="inserted">	login: async ({ cookies, request, url }) =&gt; {
</span>		const data = await request.formData();
		const email = data.get(&#39;email&#39;);
		const password = data.get(&#39;password&#39;);

		const user = await db.getUser(email);
		if (!user) {
			return fail(400, { email, missing: true });
		}

		if (user.password !== hash(password)) {
			return fail(400, { email, incorrect: true });
		}

		cookies.set(&#39;sessionid&#39;, await db.createSession(user), { path: &#39;/&#39; });

<span class="inserted">		if (url.searchParams.has(&#39;redirectTo&#39;)) {
</span><span class="inserted">			redirect(303, url.searchParams.get(&#39;redirectTo&#39;));
</span><span class="inserted">		}
</span>
		return { success: true };
	},
	register: async (event) =&gt; {
		// TODO register the user
	}
};
</code></pre></div>