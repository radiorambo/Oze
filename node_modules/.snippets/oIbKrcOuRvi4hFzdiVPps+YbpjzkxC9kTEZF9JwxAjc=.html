<div class="copy-code-block code-block"><span class="filename">src/routes/login/+page.server.js</span><pre class="language-diff" style="background-color: var(--shiki-color-background)"><code><span class="inserted">import { fail } from &#39;@sveltejs/kit&#39;;
</span>
/** @type {import(&#39;./$types&#39;).Actions} */
export const actions = {
	login: async ({ cookies, request }) =&gt; {
		const data = await request.formData();
		const email = data.get(&#39;email&#39;);
		const password = data.get(&#39;password&#39;);

<span class="inserted">		if (!email) {
</span><span class="inserted">			return fail(400, { email, missing: true });
</span><span class="inserted">		}
</span>
		const user = await db.getUser(email);

<span class="inserted">		if (!user || user.password !== hash(password)) {
</span><span class="inserted">			return fail(400, { email, incorrect: true });
</span><span class="inserted">		}
</span>
		cookies.set(&#39;sessionid&#39;, await db.createSession(user), { path: &#39;/&#39; });

		return { success: true };
	},
	register: async (event) =&gt; {
		// TODO register the user
	}
};
</code></pre></div>